---

dependencies:
  - role: portage
    portage_configuration:
      - section: "package.use"
        file: "openproject"
        entries:
          - ">=dev-libs/openssl-1.0.2d -bindist"
      - section: "package.use"
        file: "openproject"
        entries:
          - "dev-vcs/git -perl -gpg -webdav"
    portage_packages:
      - { package: "media-gfx/imagemagick" }
      - { package: "dev-vcs/git" }
      - { package: "net-misc/curl" }
      - { package: "net-misc/memcached" }
      - { package: "dev-lang/ruby" }
      - { package: "net-misc/openssh" }
      - { package: "net-libs/nodejs" }
      - { package: "www-apache/passenger" }
  - role: mysql
  - role: mysql-admin
    mysql_databases:
      - name: "{{ openproject_mysql.name }}"
    mysql_users:
      - name: "{{ openproject_mysql.user }}"
        pass: "{{ openproject_mysql.pass }}"
        priv: "{{ openproject_mysql.name }}.*:ALL"
  - role: apache
    apache_opts: ["PASSENGER"]
